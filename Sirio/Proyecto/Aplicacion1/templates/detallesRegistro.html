{% include 'admin_nav.html' %}
{% include 'base.html' %}
{% block content %}
{% load static %}


<!DOCTYPE html>
<header>
    {% block css %}
    <link rel="stylesheet" href="{% static '/estilos.css' %}">
    {% endblock %}
</header>
<div class="container mt-3">
    <form method="GET" action="{% url 'ProfesorLista' %}">
        <div class="input-group">
            </button>
        </div>
    </form>
</div>




<head>
   
    <link rel="stylesheet" href="{% static '/estilos.css' %}">
   


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>




    <link rel="shortcut icon" type="image/x-icon" href="{% static 'core/img/favicon.ico' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
   
   
</head>
<body>
    <style>
      body {
            min-height: 100vh;
            background: linear-gradient(135deg, rgba(45,0,60,0.95), rgba(15,5,100,0.85));
            font-family: 'Segoe UI', Roboto, sans-serif;
            color: #ffffff;
            margin: 0;
        }
       

        .table th, .table td {
            border: none;
            
        }

        .table thead th {
            background-color: #111;
            color: #fff;
            font-weight: 600;
            border-bottom: 2px solid #8a2be2;
            box-shadow: 0 2px 6px rgba(138, 43, 226, 0.3);
            text-align: center;
        }

        .table tbody tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .table tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }
        
        /* Cabecera de la tabla */
        .table thead th {
            background-color: #111;
            color: #f8f8f8;
        }

        .tabla-redondeada {
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #444;
        }
        
        .tabla-container {
            position: relative; /* base para la botonera */
        }
        .table-responsive {
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        /* Tablas */
        .botonera-superior {
            position: absolute;
            top: 10px;      /* distancia desde la parte superior de la tabla */
            right: 10px;    /* distancia desde el borde derecho de la tabla */
            display: flex;
            gap: 10px;
            z-index: 1000;
        }


    </style>


<div class="container mt-4 tabla-container position-relative">
        <h1>Ingresos/Egresos de Profes</h1> 
    
        <div class="botonera-superior">
            <div class="col-mt-4">
                <input type="date" class="form-control" id="fecha" name="fecha" value="{{ hoy }}">
            </div>
            <div class="col-auto">
                <button class="btn btn-primary" type="button" id="buscar">
                    <i class="fas fa-search"></i> Buscar
                </button>
            </div>
        </div>

    <div class="table-responsive tabla-redondeada">
        <table class="table table-striped table-hover mb-0">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Fecha Ingreso</th>
                    <th>Hora Ingreso</th>
                    <th>Hora Salida</th>
                </tr>
            </thead>
            <tbody id="tablaAsistencia">
                {% for registro in page_obj %}
                <tr>
                    <td>{{ registro.profesor.nombre }}</td>
                    <td>{{ registro.fecha_hora_ingreso|date:"d/m/Y" }}</td>
                    <td>{{ registro.fecha_hora_ingreso|time:"H:i:s" }}</td>
                    <td>
                        {% if registro.fecha_hora_egreso %}
                            {{ registro.fecha_hora_egreso|time:"H:i:s" }}
                        {% else %}
                            No registrado
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">No hay registros disponibles.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
</div>


<!-- Contenedor para la paginación -->
<div id="paginacion" class="pagination justify-content-center mt-3">
    {% if page_obj.has_previous %}
        <a class="btn btn-sm btn-outline-light text-dark rounded-pill me-2" href="?page={{ page_obj.previous_page_number }}" aria-label="Página anterior">
            &laquo; Anterior
        </a>
    {% endif %}


    <span class="btn btn-sm btn-outline-light text-dark rounded-pill disabled">
        Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
    </span>


    {% if page_obj.has_next %}
        <a class="btn btn-sm btn-outline-light text-dark rounded-pill ms-2" href="?page={{ page_obj.next_page_number }}" aria-label="Página siguiente">
            Siguiente &raquo;
        </a>
    {% endif %}
</div>


<!-- AJAX para Filtrar Asistencia de Profesores por Fecha y Página -->
<script>
    $(document).ready(function () {
        // Función para cargar los registros con paginación
        function cargarRegistros(fecha, pagina = 1) {
            $.ajax({
                type: "GET",
                url: "{% url 'ListarProfesoresIngresados' %}",
                data: { fecha: fecha, page: pagina },  // Pasamos el número de página
                success: function (response) {
                    let tabla = $("#tablaAsistencia");
                    tabla.empty();  // Limpiar la tabla antes de agregar nuevos datos


                    if (response.status === "success" && response.registros.length > 0) {
                        response.registros.forEach(function (registro) {
                            // Añadir fila a la tabla
                            let fila = `<tr>
                                <td>${registro.profesor}</td>
                                <td>${registro.fecha}</td>
                                <td>${registro.hora_ingreso}</td>
                                <td>${registro.hora_salida}</td>
                            </tr>`;
                            tabla.append(fila);
                        });
                    } else {
                        tabla.append('<tr><td colspan="4" class="text-center">No hay registros.</td></tr>');
                    }


                    // Actualizar los controles de paginación (vaciar y luego añadir)
                    let paginacion = $("#paginacion");
                    paginacion.html(response.paginacion);  // Insertar los nuevos controles de paginación
                },
                error: function () {
                    alert("Hubo un error al obtener los registros.");
                }
            });
        }


        // Cargar los registros al inicio con la fecha por defecto y la página 1
        let fechaInicial = $("#fecha").val();  // Usar la fecha actual por defecto
        cargarRegistros(fechaInicial);


        // Evento para el botón de búsqueda
        $("#buscar").click(function () {
            let fechaSeleccionada = $("#fecha").val();  // Obtener la fecha seleccionada
            if (fechaSeleccionada) {
                cargarRegistros(fechaSeleccionada, 1);  // Filtrar registros por la fecha seleccionada y página 1
            } else {
                alert("Por favor, selecciona una fecha.");
            }
        });


        // Manejar el cambio de página desde los botones de paginación
        $(document).on("click", ".pagination a", function (event) {
            event.preventDefault();  // Evitar el comportamiento por defecto del enlace
            let pagina = $(this).attr("href").split("page=")[1];  // Obtener el número de página desde el enlace
            let fechaSeleccionada = $("#fecha").val();  // Obtener la fecha seleccionada
            cargarRegistros(fechaSeleccionada, pagina);  // Cargar los registros para la página seleccionada
        });
    });
</script>
</body>
</html>
{% endblock %}
