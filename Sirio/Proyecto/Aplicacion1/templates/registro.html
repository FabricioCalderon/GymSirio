{% include 'base.html' %}
{% block content %}
{% load django_bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% load static %}

<!DOCTYPE html>
<html lang="es"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Profesores</title>
    <link rel="stylesheet" id="css-main" href="{% static 'css1/codebase.min.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<style>
    body {
        min-height: 100vh;
        background: linear-gradient(135deg, rgba(45, 0, 60, 0.95), rgba(15, 5, 100, 0.85));
        display: flex;
        flex-direction: column;
        font-family: 'Segoe UI', Roboto, sans-serif;
        color: #ffffff;
        margin: 0;
        justify-content: center;
        align-items: center;
        padding: 10px;
    }

    .form-container {
        width: 100%;
        max-width: 480px; /* üîπ m√°s angosto */
        position: relative;
    }

    .card {
        background:#ffffff;
        border: 1px solid rgba(155, 77, 255, 0.2);
        border-radius: 16px;
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        transition: all 0.3s ease;
    }

    .card-header {
        background: linear-gradient(45deg, #007bff, #0056b3);
        border-top-left-radius: 16px !important;
        border-top-right-radius: 16px !important;
        padding: 10px 15px; /* üîπ m√°s bajo */
    }

    .card-header h2 {
        font-size: 1.2rem; /* üîπ m√°s compacto */
        font-weight: 600;
        margin: 0;
    }

    .card-body {
        position: relative;
        padding: 15px; /* üîπ menos espacio interno */
    }

    /* ===== Input general ===== */
    .form-group {
        margin-bottom: 12px;
    }

    .form-group label {
        font-size: 0.9rem;
        font-weight: 600;
    }

    .input-group-text {
        font-size: 1.2rem !important;
        padding: 6px 10px;
    }

    .form-control {
        border-radius: 10px !important;
        font-size: 0.9rem;
        padding: 6px 10px;
        height: 38px;
        transition: all 0.3s ease;
    }

    .form-control:focus {
        border-color: #9b4dff;
        box-shadow: 0 0 8px rgba(155, 77, 255, 0.4);
        background-color: rgba(255, 255, 255, 0.08);
        color: #fff;
    }

    /* ===== Bot√≥n ===== */
    .btn-success {
        border: none;
        border-radius: 30px;
        background: linear-gradient(135deg, #28a745, #66bb6a);
        color: #fff;
        font-weight: 600;
        font-size: 0.9rem;
        padding: 6px 16px;
        transition: all 0.3s ease;
    }

    .btn-success:hover {
        background: linear-gradient(135deg, #34d058, #85e085);
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(40, 167, 69, 0.4);
    }

    /* ===== Popup mensaje ===== */
    #mensajePopup {
        display: none;
        position: absolute;
        top: 8px; /* üîπ m√°s cerca del borde superior */
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        width: 90%;
        max-width: 350px;
        text-align: center;
        border-radius: 8px;
        color: white;
        font-size: 15px;
        z-index: 1050;
        font-weight: bold;
    }

    /* ===== Placeholder visible ===== */
    #dni::placeholder {
        color: black;
        opacity: 1;
    }

    /* ===== Ajuste responsivo ===== */
    @media (max-height: 700px) {
        body {
            padding-top: 20px;
        }
        .card {
            transform: scale(0.95);
        }
    }

    @media (max-width: 500px) {
        .card {
            max-width: 95%;
        }
        .card-header h2 {
            font-size: 1.1rem;
        }
    }
</style>

<body>
    <div class="container d-flex justify-content-center align-items-center vh-80">
        <div class="card shadow-lg w-100 form-container">
            <div class="card-header text-white text-center fw-bold py-3"
                style="background: linear-gradient(45deg, #007bff, #0056b3); border-top-left-radius: 12px; border-top-right-radius: 12px;">
                <h2 class="mb-0 d-flex align-items-center justify-content-center">
                    <i class="fas fa-user-check me-2"></i> Registro de Profesores
                </h2>
            </div>
            <div class="card-body">
                <form id="profesorForm">
                    <!-- DNI -->
                    <div class="form-group mb-3">
                        <label for="dni" class="fs-5 fw-bold" style="color: #007bff;">DNI:</label>
                        <div class="input-group">
                            <span class="input-group-text fs-4" style="color: #007bff; border-color: #ffffff;">
                                <i class="fas fa-id-card"></i>
                            </span>
                            <input type="text" id="dni" name="dni" class="form-control form-control-lg" required 
                                placeholder="Ingrese su DNI" 
                                autocomplete="off"
                                style="border-color: #007bff; background-color: #6da1f0; color: #070707; border-radius: 15px; box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2); transition: all 0.3s ease;">
                        </div>
                    </div>

                     <!-- Nombre del Profe -->
                    <div class="form-group mb-3">
                        <label class="fs-5 fw-bold" for="nombreInput" style="color: #28a745;">Profe:</label>
                        <div class="input-group">
                            <span class="input-group-text fs-4" style="color: #28a745; border-color: #ffffff;">
                                <i class="fas fa-user"></i>
                            </span>
                            <input type="text" id="nombreInput" class="form-control form-control-lg" readonly 
                                placeholder="" 
                                style="border-color: #28a745; background-color: #5cec7e; color: #070707; border-radius: 15px; box-shadow: 0 4px 8px rgba(40, 167, 69, 0.2); transition: all 0.3s ease;">
                        </div>
                    </div>

                    <!-- Hora de ingreso -->
                    <div class="form-group mb-3">
                        <label class="fs-5 fw-bold" for="horaIngresoInput" style="color: #ff9800;">Hora de Ingreso:</label>
                        <div class="input-group">
                            <span class="input-group-text fs-4" style="color: #ff9800; border-color: #ffffff;"><i class="fas fa-clock"></i></span>
                            <input type="text" id="horaIngresoInput" class="form-control form-control-lg" readonly placeholder="" style="border-color: #ff9800; background-color: #ffba53; color: #070707; border-radius: 15px; box-shadow: 0 4px 8px rgba(255, 193, 7, 0.2); transition: all 0.3s ease;">
                        </div>
                    </div>    

                    <!-- Hora de salida -->
                    <div class="form-group mb-3">
                        <label class="fs-5 fw-bold" for="horaSalidaInput" style="color: #ff9800;" >Hora de Salida:</label>
                        <div class="input-group">
                            <span class="input-group-text fs-4"style="color: #ff9800; border-color: #ffffff;"><i class="fas fa-clock"></i></span>
                            <input type="text" id="horaSalidaInput" class="form-control form-control-lg" readonly placeholder="" style="border-color: #ff9800; background-color: #ffba53; color: #070707; border-radius: 15px; box-shadow: 0 4px 8px rgba(255, 193, 7, 0.2); transition: all 0.3s ease;">
                        </div>
                    </div>    

                    <!-- Bot√≥n de env√≠o -->
                    <button class="btn btn-success w-100 mt-3" type="submit">
                        <i class="fas fa-check-circle"></i> Registrar
                    </button>
                </form>
                
                <!-- Popup mensaje -->
                <div id="mensajePopup"></div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            function mostrarMensaje(texto, tipo) {
                let mensajePopup = $("#mensajePopup");
                let icono = "";
                
                // Verificar si el mensaje es "Asistencia registrada" y hacerlo verde
                if (texto === "Asistencia registrada.") {
                    icono = '<i class="fas fa-check-circle"></i> '; // √çcono de √©xito (tilde verde)
                    mensajePopup.css({
                        "background-color": "rgba(40, 167, 69, 0.9)", // Verde
                        "border": "1px solid rgba(40, 167, 69, 1)" // Borde verde
                    });
                } else {
                    icono = '<i class="fas fa-exclamation-triangle"></i> '; // √çcono de advertencia (warning rojo)
                    mensajePopup.css({
                        "background-color": "rgba(220, 53, 69, 0.9)", // Rojo
                        "border": "1px solid rgba(220, 53, 69, 1)" // Borde rojo
                    });
                }

                // Mostrar el mensaje con el icono
                mensajePopup.html(icono + texto).fadeIn();

                // Ocultar despu√©s de 5 segundos
                setTimeout(function () {
                    mensajePopup.fadeOut();
                }, 5000);
            }

            $("#profesorForm").on("submit", function (e) {
                e.preventDefault();

                $.ajax({
                    type: "POST",
                    url: "{% url 'registro_profesor' %}",
                    data: {
                        dni: $("#dni").val(),
                        csrfmiddlewaretoken: "{{ csrf_token }}"
                    },
                    success: function (response) {
                        if (response.status === "success") {
                            mostrarMensaje("Asistencia registrada.", "success");

                             // ‚úÖ Asignar el nombre del profesor al input
                             $("#nombreInput").val(response.nombre_profesor || "");

                            // Actualizar los campos con la informaci√≥n recibida
                            $("#horaIngresoInput").val(response.hora_ingreso || "");
                            $("#horaSalidaInput").val(response.hora_salida || "");

                            // Limpiar los datos despu√©s de 10 segundos
                            setTimeout(function () {
                                $("#dni").val("").focus();
                                $("#nombreInput").val("");
                                $("#horaIngresoInput").val("");
                                $("#horaSalidaInput").val("");
                                $("#dni").trigger("focus"); // Mantener el foco en DNI
                            }, 10000); 
                        } else {
                            mostrarMensaje(response.mensaje, "error");
                            // ‚úÖ Limpiar solo el campo DNI si el profe no existe
                            setTimeout(function () {
                                console.log("Limpiando DNI...");
                                $("#dni").val("").focus();
                            }, 10000);
                        }
                    },
                    error: function () {
                        mostrarMensaje("Error en el servidor. Int√©ntalo m√°s tarde.", "error");
                    }
                });
            });

            function mantenerFocus() {
                setTimeout(function () {
                    $("#dni").trigger("focus");
                }, 10);
            }

            mantenerFocus();
            $("#dni").on("blur", function () {
                mantenerFocus();
            });
        });
    </script>
</body>              
</html>
{% endblock %}
